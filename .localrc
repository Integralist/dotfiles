#!/usr/bin/env bash

echo .localrc loaded

export PATH="/usr/local/go/bin:$PATH"
export PATH="$HOME/go/bin:$PATH"
export PATH="$HOME/.cargo/bin:$PATH"
export PATH="$HOME/.pyenv/shims:$PATH"
export GPG_TTY=$(tty)

# configure fnm node version manager
#
eval "$(fnm env)"

# configure python environment
# requires PATH modification above
#
eval "$(python3 -m pip completion --bash)"
eval "$(pyenv init -)"
eval "$(pyenv virtualenv-init -)"

# configure terraform auto-complete
#
complete -C /usr/local/bin/terraform terraform

# configure rust environment
#
# - autocomplete
# - rust-analyzer
# - cargo audit
# - cargo fmt
#
if [ ! -f "$HOME/.config/rustlang/autocomplete/rustup" ]; then
    mkdir -p ~/.config/rustlang/autocomplete
    rustup completions bash rustup >> ~/.config/rustlang/autocomplete/rustup
fi
source "$HOME/.config/rustlang/autocomplete/rustup"
if ! command -v rust-analyzer &> /dev/null
then
    brew install rust-analyzer
fi
if ! cargo audit --version &> /dev/null; then
    cargo install cargo-audit --features=fix
fi
if ! cargo fmt --version &> /dev/null; then
    rustup component add rustfmt
fi
if ! cargo clippy --version &> /dev/null; then
    rustup component add clippy
fi

# broot (tree replacement) requires a companion shell function to allow
# alt+enter to cd into a directory.
#
# this setup is based on me installing broot from source repo:
#
# cargo install --path .
# mv target/release/broot /usr/local/bin/broot
#
# you'll find broot needs a `br` shell function which it will prompt you to
# allow it to create and it will manipulate your shell configuration files like
# .bash_profile and .bashrc so move the source line from there to here.
#
# extra configuration found here:
# /Users/integralist/Library/Application Support/org.dystroy.broot/conf.hjson
#
if [ -f "/Users/integralist/Library/Application Support/org.dystroy.broot/launcher/bash/br" ]; then
    source "/Users/integralist/Library/Application Support/org.dystroy.broot/launcher/bash/br"
fi

# zoxide is a directory switcher
#
# z <pattern>
# zoxide query -ls
#
eval "$(zoxide init bash)"

# to ensure there are no duplicates in the $PATH we call dedupe
# the dedupe function is defined in .bashrc
#
dedupe
