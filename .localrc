#!/usr/bin/env bash

echo .localrc loaded

export PATH="/usr/local/go/bin:$PATH"
export PATH="$HOME/go/bin:$PATH"
export PATH="$HOME/.cargo/bin:$PATH"
export GPG_TTY=$(tty)

# the following was added dynamically to .bashrc but I move it here instead
# note: manually added --no-use to prevent it loading nvm on each shell load
#
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" --no-use
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"

# configure python environment
#
eval "$(python3 -m pip completion --bash)"
eval "$(pyenv init -)"
eval "$(pyenv virtualenv-init -)"

# configure terraform auto-complete
#
complete -C /usr/local/bin/terraform terraform

# rustup autocomplete
#
if [ ! -f "$HOME/.config/rustlang/autocomplete/rustup" ]; then
    mkdir -p ~/.config/rustlang/autocomplete
    rustup completions bash rustup >> ~/.config/rustlang/autocomplete/rustup
fi
source "$HOME/.config/rustlang/autocomplete/rustup"

# broot (tree replacement) requires a companion shell function to allow
# alt+enter to cd into a directory.
#
if [ -f "$HOME/.config/broot/launcher/bash/br" ]; then
    source "$HOME/.config/broot/launcher/bash/br"
fi

# zoxide is a directory switcher
#
# z <pattern>
# zoxide query -ls
#
eval "$(zoxide init bash)"

# to ensure there are no duplicates in the $PATH we call dedupe
# the dedupe function is defined in .bashrc
#
dedupe
